import{g as o,f as H,m as J,n as Q,p as N,E as W,_ as X,r as Y,o as u,c as p,a as n,b as r,u as s,q as O,w as d,F as B,v as E,e as j,x as Z,t as S,s as h,j as I,y as ee,k as b,A as se,B as te}from"./index-46789d2d.js";import{m as ae,u as le,a as oe,s as re,b as ie,c as ne,d as de}from"./device-696bf6c2.js";import{s as ue}from"./selectbutton.esm-7b4aa055.js";import{s as ce}from"./inputtext.esm-02797870.js";import{s as fe}from"./dropdown.esm-86d06d88.js";import{s as pe}from"./confirmdialog.esm-8f4b6383.js";import{a as K}from"./dialog.esm-b2c72f6f.js";import{u as me}from"./store-c8c6a8c2.js";import{u as ve}from"./globalStore-0205f4e8.js";import"./paginator.esm-10ff620d.js";import"./index.esm-94a9ac72.js";const _e=()=>{const i=o(!0),m=me(),_=o(),L=o(),l=o({}),V=o(),$=o(0),y=o(""),g=ve(),T=o(["Ongoing","Discharged"]),z=o([{field:"id",header:"ID",selected:!1,style:"min-width: 5rem",frozen:!1},{field:"am_number",header:"AM Number",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"user_full_name",header:"CM",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"patient_name",header:"Patient",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"actions",header:"Transfers",sortable:!1,selected:!0,style:"min-width: 10rem",frozen:!0,alignFrozen:"right"}]),w=o(null);H(()=>{C(),f(),U()}),J(()=>{m.$dispose()});const f=async()=>{i.value=!0,await m.fetchAll({page:l.value.page+=1,per_page:l.value.rows,order:ae(l.value.multiSortMeta),search:y.value,status:w.value});const t=m.getAllResponse;t&&(V.value=t.data,$.value=t.meta.total),i.value=!1},C=()=>{l.value={page:0,rows:L.value.rows,multiSortMeta:[],first:0}},k=t=>{l.value=t,l.value.multiSortMeta=[],f()},R=t=>{l.value=t,l.value.page=0,l.value.first=0,f()},D=t=>{_.value.toggle(t)},x=Q(()=>z.value.filter(t=>t.selected));N([y],le(()=>{C(),f()},500)),N([w],()=>{C(),f()});const M=o(!1),P=o([]),U=async()=>{console.log("fetching users"),i.value=!0,await g.fetchAllUser({role:4});const t=g.getAllUserResponse;if(t){const{options:A}=t.data;P.value=A}i.value=!1},v=o({user_id:"",case_id:""}),a=async()=>{i.value=!0;try{await m.transferCase({case_id:v.value.case_id,user_id:v.value.user_id});const t=m.getTransferCaseResponse;t&&c("Case is transferred to "+t.data.data.full_name,"success"),i.value=!1,M.value=!1,l.value.page=l.value.page-1,v.value.user_id="",f()}catch(t){i.value=!1,c(t,"error")}},F=o(!1),e=()=>{},c=(t,A="error",G=5e3)=>{W.emit("show-toast",{severity:A,summary:"",detail:t,life:G})};return{dt:L,lazyParams:l,totalRecords:$,records:V,isLoading:i,search:y,statusOptions:T,selectedStatus:w,onPage:k,onSort:R,toggleColumnMenu:D,selectedColumns:x,columns:z,columnMenu:_,transferTo:v,cmUserOptions:P,transferCase:a,visibleTransfer:M,downloadCases:e,visibleDownload:F}};const q=i=>(se("data-v-9ee0434e"),i=i(),te(),i),ge={class:"card mb-4"},he={class:"flex justify-content-left"},be={class:"card"},ye={class:"flex flex-wrap flex-row-reverse align-items-center"},we={class:"p-input-icon-left mr-2 mb-2 flex-1"},Ce=q(()=>n("i",{class:"pi pi-search"},null,-1)),ke=["for"],xe={key:0},Pe={key:1},Se={key:2},Le={key:1},Ve={class:"text-center w-full"},$e={class:"mt-2"},ze={class:"field col-12"},Me=q(()=>n("div",{class:"field col-12"},null,-1)),Te={__name:"List",setup(i){const{statusOptions:m,selectedStatus:_,dt:L,lazyParams:l,totalRecords:V,records:$,isLoading:y,search:g,onPage:T,onSort:z,selectedColumns:w,columns:f,columnMenu:C,transferTo:k,transferCase:R,cmUserOptions:D,visibleTransfer:x,downloadCases:M,visibleDownload:P}=_e(),{isMobile:U}=oe();return(v,a)=>{const F=Y("router-link");return u(),p(B,null,[n("div",null,[n("div",ge,[n("div",he,[r(s(ue),{modelValue:s(_),"onUpdate:modelValue":a[0]||(a[0]=e=>O(_)?_.value=e:null),options:s(m),"aria-labelledby":"basic"},null,8,["modelValue","options"])])]),n("div",be,[r(s(de),{ref_key:"dt",ref:L,dataKey:"id",lazy:!0,paginator:!0,value:s($),onPage:a[2]||(a[2]=e=>s(T)(e)),onSort:a[3]||(a[3]=e=>s(z)(e)),sortMode:"multiple",multiSortMeta:s(l).multiSortMeta,totalRecords:s(V),rows:5,rowsPerPageOptions:[5,10,20,50,100],scrollable:!0,first:s(l).first,scrollHeight:"60vh",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"{first} to {last} of total {totalRecords}",loading:s(y),responsiveLayout:"scroll"},{header:d(()=>[n("div",ye,[r(s(h),{class:"mb-2 flex-2 mr-2",label:"Download",icon:"pi pi-download",severity:"secondary",text:""}),n("span",we,[Ce,r(s(ce),{modelValue:s(g),"onUpdate:modelValue":a[1]||(a[1]=e=>O(g)?g.value=e:null),placeholder:"Keyword Search",class:"w-full md:w-auto"},null,8,["modelValue"])]),r(s(re),{ref_key:"columnMenu",ref:C,appendTo:"body",id:"columnPanel",style:{width:"250px"}},{default:d(()=>[(u(!0),p(B,null,E(s(f),e=>(u(),p("div",{key:e.field,class:"field-checkbox"},[r(s(ie),{inputId:e.field,name:"column",modelValue:e.selected,binary:!0,onChange:c=>e.selected=!e.selected,disabled:e.frozen},null,8,["inputId","modelValue","onChange","disabled"]),n("label",{for:e.field},S(e.header),9,ke)]))),128))]),_:1},512)])]),empty:d(()=>[j(" No records found. ")]),loading:d(()=>[j(" Loading records data. Please wait. ")]),default:d(()=>[(u(!0),p(B,null,E(s(w),e=>(u(),I(s(ne),{key:e.field,field:e.field,header:e.header,sortable:e.sortable,frozen:!s(U)&&e.frozen,alignFrozen:e.alignFrozen,style:ee(e.style)},{body:d(({data:c})=>[v.$can("view","Case")?(u(),I(F,{key:0,class:"text-black-alpha-90",to:{name:"viewCase",params:{id:c.id}}},{default:d(()=>[e.field==="am_number"?(u(),p("div",xe,S(c.am_number),1)):b("",!0),e.field==="user_full_name"?(u(),p("div",Pe,S(c.user_full_name),1)):b("",!0),e.field==="patient_name"?(u(),p("div",Se,S(c.patient_name),1)):b("",!0)]),_:2},1032,["to"])):b("",!0),e.field==="actions"?(u(),p("div",Le,[v.$can("transfer","Case")?(u(),I(s(h),{key:0,type:"button",icon:"pi pi-arrow-up-right",class:"p-button-primary",text:"",rounded:"",onClick:t=>(x.value=!0,s(k).case_id=c.id)},null,8,["onClick"])):b("",!0)])):b("",!0)]),_:2},1032,["field","header","sortable","frozen","alignFrozen","style"]))),128))]),_:1},8,["value","multiSortMeta","totalRecords","first","loading"])])]),r(s(pe),null,{message:d(e=>[n("div",Ve,[n("i",{class:Z([e.message.icon,"mt-2 text-red-500 text-5xl"])},null,2),n("div",$e,S(e.message.message),1)])]),_:1}),r(s(K),{closable:!1,visible:s(x),modal:"",style:{width:"25rem"},header:"Transfer case to:"},{footer:d(()=>[r(s(h),{label:"Cancel",icon:"pi pi-times",onClick:a[5]||(a[5]=e=>x.value=!1),text:""}),r(s(h),{label:"Transfer",icon:"pi pi-check",onClick:s(R),autofocus:""},null,8,["onClick"])]),default:d(()=>[n("div",ze,[r(s(fe),{id:"transfer_to",modelValue:s(k).user_id,"onUpdate:modelValue":a[4]||(a[4]=e=>s(k).user_id=e),options:s(D),optionLabel:"full_name",optionValue:"id",class:"w-full",filter:""},null,8,["modelValue","options"])])]),_:1},8,["visible"]),r(s(K),{closable:!1,visible:s(P),modal:"",style:{width:"25rem"},header:"Download Cases Report"},{footer:d(()=>[r(s(h),{label:"Cancel",icon:"pi pi-times",onClick:a[6]||(a[6]=e=>P.value=!1),text:""}),r(s(h),{label:"Transfer",icon:"pi pi-check",onClick:s(M),autofocus:""},null,8,["onClick"])]),default:d(()=>[Me]),_:1},8,["visible"])],64)}}},Ke=X(Te,[["__scopeId","data-v-9ee0434e"]]);export{Ke as default};
