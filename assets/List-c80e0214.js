import{z as o,A as ae,L as oe,M as re,B as J,N as ne,_ as ie,r as de,o as i,c as f,a,b as n,G as s,I as H,i as _,w as u,g as K,F as W,p as X,e as B,n as ue,t as $,k as w,H as ce,P as fe,Q as pe}from"./index-69d6ec4d.js";import{m as me,u as ve,a as _e,s as ge,b as he,c as Z,d as ye}from"./device-e97b20ec.js";import{s as Ce}from"./selectbutton.esm-4a3f39dd.js";import{s as be}from"./inputtext.esm-b63f6d65.js";import{s as ee}from"./dropdown.esm-4fdf3fce.js";import{s as we}from"./confirmdialog.esm-a366119a.js";import{a as se}from"./dialog.esm-1ce8a731.js";import{u as ke}from"./store-ede68f89.js";import{u as Se}from"./globalStore-bbb814f5.js";import"./paginator.esm-346c912e.js";import"./index.esm-922b7932.js";const Me=()=>{const r=o(!0),c=ke(),k=o(),S=o(),d=o({}),P=o(),U=o(0),V=o(""),I=Se(),x=o(["Ongoing","Completed","Discharged"]),N=o([{field:"id",header:"ID",selected:!1,style:"min-width: 5rem",frozen:!1},{field:"am_number",header:"AM Number",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"length_of_stay",header:"Length of Stay",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"user_full_name",header:"CM",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"patient_name",header:"Patient",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"actions",header:"Transfers",sortable:!1,selected:!0,style:"min-width: 10rem",frozen:!0,alignFrozen:"right"}]),M=o("Ongoing"),g=o(null),A=o(null),F=o("Transfer case to:"),C=o(!1),O=o([]);ae(()=>{h(),p(),j()}),oe(()=>{c.$dispose()});const p=async()=>{r.value=!0,await c.fetchAll({page:d.value.page+=1,per_page:d.value.rows,order:me(d.value.multiSortMeta),search:V.value,status:M.value,user_id:g.value});const t=c.getAllResponse;t&&(P.value=t.data,U.value=t.meta.total),r.value=!1},h=()=>{d.value={page:0,rows:S.value.rows,multiSortMeta:[],first:0}},Q=t=>{d.value=t,d.value.multiSortMeta=[],p()},E=t=>{d.value=t,d.value.page=0,d.value.first=0,p()},G=t=>{k.value.toggle(t)},Y=re(()=>N.value.filter(t=>t.selected)),z=o(!1),D=o([]);J([V],ve(()=>{h(),p()},500)),J([g],()=>{A.value=D.value.find(t=>t.id==g.value).full_name}),J([g,M],()=>{h(),p()});const j=async()=>{console.log("fetching users"),r.value=!0,await I.fetchAllUser({role:4});const t=I.getAllUserResponse;if(t){const{options:v}=t.data;D.value=v}r.value=!1},L=()=>{if(g.value==null){alert("You need to choose CM");return}if(M.value!="Ongoing"){alert("Only Ongoing cases can be transferred");return}z.value=!0,F.value=`Transfer Ongoing Cases of [${A.value}] to:`,C.value=!0},y=o({user_id:"",case_id:""}),b=async()=>{if(y.value.user_id==""){alert("Select CM");return}r.value=!0;try{if(C.value===!1){await c.transferCase({case_id:y.value.case_id,user_id:y.value.user_id});const t=c.getTransferCaseResponse;t&&e("Case is transferred to "+t.data.data.full_name,"success")}else{await c.transferBulkCase({from_user_id:g.value,to_user_id:y.value.user_id});const t=c.getTransferCaseResponse;t&&e("Case is transferred to "+t.data.data.full_name,"success")}r.value=!1,z.value=!1,d.value.page=d.value.page-1,y.value.user_id="",p()}catch(t){r.value=!1,e(t,"error")}},l=o(!1),q=()=>{},e=(t,v="error",T=5e3)=>{ne.emit("show-toast",{severity:v,summary:"",detail:t,life:T})};return{dt:S,lazyParams:d,totalRecords:U,records:P,isLoading:r,search:V,statusOptions:x,selectedStatus:M,selectedUser:g,onPage:Q,onSort:E,toggleColumnMenu:G,selectedColumns:Y,columns:N,columnMenu:k,transferTo:y,cmUserOptions:D,transferCase:b,visibleTransfer:z,downloadCases:q,visibleDownload:l,transferTitle:F,isBulkTransfer:C,transferBulkCaseClick:L,calculateLengthOfStay:(t,v)=>{let T=null;const le=new Date(t);return T=(new Date(v)-le)/(1e3*60*60*24),T=Math.round(T),T},deleteCase:async()=>{if(!confirm("Are you sure you want to delete this case?"))return;const t=O.value.map(v=>v.id);if(r.value=!0,t.length===0){e("No cases selected for deletion","warn"),r.value=!1;return}try{await c.deleteCase({ids:t}),c.getDeleteCaseResponse&&(e("Case deleted successfully","success"),O.value=[],h(),p())}catch(v){e(v,"error")}finally{r.value=!1}},selectedCases:O}};const R=r=>(fe("data-v-60d33378"),r=r(),pe(),r),Le={class:"card mb-4"},Te={class:"grid"},$e={class:"field col-12 md:col-6 lg:col-4"},Pe=R(()=>a("label",{class:"label-sm"},[a("i",{class:"pi pi-filter"}),B("  Status ")],-1)),Ve={key:0,class:"field col-12 md:col-6 lg:col-4"},xe=R(()=>a("label",{class:"label-sm"},[a("i",{class:"pi pi-filter"}),B("  CM ")],-1)),Oe={key:1,class:"field col-12 md:col-6 lg:col-4"},ze=R(()=>a("label",{class:"label-sm"},[a("i",{class:"pi pi-filter"}),B("  Bulk Transfer ")],-1)),De={class:"card"},Be={class:"flex flex-wrap align-items-center"},Re={class:"p-input-icon-left mr-2 mb-2 flex-1"},Ue=R(()=>a("i",{class:"pi pi-search"},null,-1)),Ie=["for"],Ne={key:0},Ae={key:1},Fe={key:2},Ee={key:3},Ge={key:1},He={class:"text-center w-full"},Ke={class:"mt-2"},Qe={class:"field col-12"},Ye=R(()=>a("div",{class:"field col-12"},null,-1)),je={__name:"List",setup(r){const{statusOptions:c,selectedStatus:k,selectedUser:S,dt:d,lazyParams:P,totalRecords:U,records:V,isLoading:I,search:x,onPage:N,onSort:M,selectedColumns:g,columns:A,columnMenu:F,transferTo:C,transferCase:O,cmUserOptions:p,visibleTransfer:h,downloadCases:Q,visibleDownload:E,transferTitle:G,isBulkTransfer:Y,transferBulkCaseClick:z,calculateLengthOfStay:D,deleteCase:j,selectedCases:L}=Me(),{isMobile:y}=_e();return(b,l)=>{const q=de("router-link");return i(),f(W,null,[a("div",null,[a("div",Le,[a("div",Te,[a("div",$e,[Pe,n(s(Ce),{modelValue:s(k),"onUpdate:modelValue":l[0]||(l[0]=e=>H(k)?k.value=e:null),options:s(c),"aria-labelledby":"basic",class:"w-full"},null,8,["modelValue","options"])]),b.$can("transfer","BulkCase")?(i(),f("div",Ve,[xe,n(s(ee),{modelValue:s(S),"onUpdate:modelValue":l[1]||(l[1]=e=>H(S)?S.value=e:null),options:s(p),optionLabel:"full_name",optionValue:"id",placeholder:"Select CM",class:"w-full",showClear:""},null,8,["modelValue","options"])])):_("",!0),b.$can("transfer","BulkCase")?(i(),f("div",Oe,[ze,n(s(w),{class:"w-full",label:"All Ongoing Cases",icon:"pi pi-arrow-up-right",onClick:s(z),severity:"primary",outlined:""},null,8,["onClick"])])):_("",!0)])]),a("div",De,[n(s(ye),{ref_key:"dt",ref:d,dataKey:"id",lazy:!0,paginator:!0,selection:s(L),"onUpdate:selection":l[4]||(l[4]=e=>H(L)?L.value=e:null),value:s(V),onPage:l[5]||(l[5]=e=>s(N)(e)),onSort:l[6]||(l[6]=e=>s(M)(e)),sortMode:"multiple",multiSortMeta:s(P).multiSortMeta,totalRecords:s(U),rows:5,rowsPerPageOptions:[5,10,20,50,100],scrollable:!0,first:s(P).first,scrollHeight:"60vh",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"{first} to {last} of total {totalRecords}",loading:s(I),responsiveLayout:"scroll"},{header:u(()=>[a("div",Be,[a("span",Re,[Ue,n(s(be),{modelValue:s(x),"onUpdate:modelValue":l[2]||(l[2]=e=>H(x)?x.value=e:null),placeholder:"Keyword Search",class:"w-full md:w-auto"},null,8,["modelValue"])]),b.$can("delete","Case")?(i(),K(s(w),{key:0,class:"mb-2 flex-2 mr-2",label:"Delete Cases",icon:"pi pi-trash",severity:"danger",text:"",disabled:s(L).length==0,onClick:l[3]||(l[3]=e=>s(j)())},null,8,["disabled"])):_("",!0),n(s(ge),{ref_key:"columnMenu",ref:F,appendTo:"body",id:"columnPanel",style:{width:"250px"}},{default:u(()=>[(i(!0),f(W,null,X(s(A),e=>(i(),f("div",{key:e.field,class:"field-checkbox"},[n(s(he),{inputId:e.field,name:"column",modelValue:e.selected,binary:!0,onChange:m=>e.selected=!e.selected,disabled:e.frozen},null,8,["inputId","modelValue","onChange","disabled"]),a("label",{for:e.field},$(e.header),9,Ie)]))),128))]),_:1},512)])]),empty:u(()=>[B(" No records found. ")]),loading:u(()=>[B(" Loading records data. Please wait. ")]),default:u(()=>[n(s(Z),{selectionMode:"multiple",headerStyle:"width: 3rem"}),(i(!0),f(W,null,X(s(g),e=>(i(),K(s(Z),{key:e.field,field:e.field,header:e.header,sortable:e.sortable,frozen:!s(y)&&e.frozen,alignFrozen:e.alignFrozen,style:ce(e.style)},{body:u(({data:m})=>[b.$can("view","Case")?(i(),K(q,{key:0,class:"text-black-alpha-90",to:{name:"viewCase",params:{id:m.id}}},{default:u(()=>[e.field==="am_number"?(i(),f("div",Ne,$(m.am_number),1)):_("",!0),e.field==="length_of_stay"?(i(),f("div",Ae,$(s(D)(m.date_of_admission!==void 0?m.date_of_admission:"",new Date().toISOString().split("T")[0]))+" Days ",1)):_("",!0),e.field==="user_full_name"?(i(),f("div",Fe,$(m.user_full_name),1)):_("",!0),e.field==="patient_name"?(i(),f("div",Ee,$(m.patient_name),1)):_("",!0)]),_:2},1032,["to"])):_("",!0),e.field==="actions"?(i(),f("div",Ge,[b.$can("transfer","Case")?(i(),K(s(w),{key:0,type:"button",icon:"pi pi-arrow-up-right",class:"p-button-primary",text:"",rounded:"",onClick:te=>(h.value=!0,s(C).case_id=m.id,G.value=`Transfer Case [${m.id}] to: `,Y.value=!1)},null,8,["onClick"])):_("",!0)])):_("",!0)]),_:2},1032,["field","header","sortable","frozen","alignFrozen","style"]))),128))]),_:1},8,["selection","value","multiSortMeta","totalRecords","first","loading"])])]),n(s(we),null,{message:u(e=>[a("div",He,[a("i",{class:ue([e.message.icon,"mt-2 text-red-500 text-5xl"])},null,2),a("div",Ke,$(e.message.message),1)])]),_:1}),n(s(se),{closable:!1,visible:s(h),modal:"",style:{width:"25rem"},header:s(G)},{footer:u(()=>[n(s(w),{label:"Cancel",icon:"pi pi-times",onClick:l[8]||(l[8]=e=>h.value=!1),text:""}),n(s(w),{label:"Transfer",icon:"pi pi-check",onClick:s(O),autofocus:""},null,8,["onClick"])]),default:u(()=>[a("div",Qe,[n(s(ee),{id:"transfer_to",modelValue:s(C).user_id,"onUpdate:modelValue":l[7]||(l[7]=e=>s(C).user_id=e),options:s(p),optionLabel:"full_name",optionValue:"id",class:"w-full",filter:""},null,8,["modelValue","options"])])]),_:1},8,["visible","header"]),n(s(se),{closable:!1,visible:s(E),modal:"",style:{width:"25rem"},header:"Download Cases Report"},{footer:u(()=>[n(s(w),{label:"Cancel",icon:"pi pi-times",onClick:l[9]||(l[9]=e=>E.value=!1),text:""}),n(s(w),{label:"Download",icon:"pi pi-check",onClick:s(Q),autofocus:""},null,8,["onClick"])]),default:u(()=>[Ye]),_:1},8,["visible"])],64)}}},is=ie(je,[["__scopeId","data-v-60d33378"]]);export{is as default};
