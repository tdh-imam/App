import{g as a,f as se,m as te,n as le,p as H,E as ae,_ as oe,r as re,o as u,c as m,a as l,b as n,u as e,q as J,k as b,w as d,F as Y,v as X,e as U,x as ne,t as L,s as C,j as Q,y as ie,A as ue,B as de}from"./index-ae04caa3.js";import{m as ce,u as fe,a as pe,s as me,b as ve,c as _e,d as ge}from"./device-979e2faa.js";import{s as he}from"./selectbutton.esm-67f3e36e.js";import{s as be}from"./inputtext.esm-64326cd5.js";import{s as Z}from"./dropdown.esm-1966edcb.js";import{s as Ce}from"./confirmdialog.esm-6920f1d4.js";import{a as ee}from"./dialog.esm-151f92d8.js";import{u as ye}from"./store-d8f4aae6.js";import{u as we}from"./globalStore-62acee67.js";import"./paginator.esm-995680d0.js";import"./index.esm-928191ab.js";const ke=()=>{const i=a(!0),c=ye(),y=a(),O=a(),r=a({}),R=a(),x=a(0),P=a(""),w=we(),I=a(["Ongoing","Completed","Discharged"]),k=a([{field:"id",header:"ID",selected:!1,style:"min-width: 5rem",frozen:!1},{field:"am_number",header:"AM Number",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"user_full_name",header:"CM",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"patient_name",header:"Patient",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"actions",header:"Transfers",sortable:!1,selected:!0,style:"min-width: 10rem",frozen:!0,alignFrozen:"right"}]),S=a("Ongoing"),V=a([]),f=a(null),B=a(null),D=a("Transfer case to:"),g=a(!1),E=async()=>{console.log("fetching users"),i.value=!0;const t=JSON.parse(localStorage.getItem("userData"));await w.fetchAllUser({parent_user:t.id});const T=w.getAllUserResponse;if(T){const{options:G}=T.data;V.value=G}i.value=!1};se(()=>{h(),v(),E(),$()}),te(()=>{c.$dispose()});const v=async()=>{i.value=!0,await c.fetchAll({page:r.value.page+=1,per_page:r.value.rows,order:ce(r.value.multiSortMeta),search:P.value,status:S.value,user_id:f.value});const t=c.getAllResponse;t&&(R.value=t.data,x.value=t.meta.total),i.value=!1},h=()=>{r.value={page:0,rows:O.value.rows,multiSortMeta:[],first:0}},K=t=>{r.value=t,r.value.multiSortMeta=[],v()},A=t=>{r.value=t,r.value.page=0,r.value.first=0,v()},N=t=>{y.value.toggle(t)},j=le(()=>k.value.filter(t=>t.selected));H([P],fe(()=>{h(),v()},500)),H([f],()=>{B.value=V.value.find(t=>t.id==f.value).full_name}),H([f,S],()=>{h(),v()});const M=a(!1),F=a([]),$=async()=>{console.log("fetching users"),i.value=!0,await w.fetchAllUser({role:4});const t=w.getAllUserResponse;if(t){const{options:T}=t.data;F.value=T}i.value=!1},o=()=>{if(f.value==null){alert("You need to choose CM");return}if(S.value!="Ongoing"){alert("Only Ongoing cases can be transferred");return}M.value=!0,D.value=`Transfer Ongoing Cases of [${B.value}] to:`,g.value=!0},_=a({user_id:"",case_id:""}),s=async()=>{if(_.value.user_id==""){alert("Select CM");return}i.value=!0;try{if(g.value===!1){await c.transferCase({case_id:_.value.case_id,user_id:_.value.user_id});const t=c.getTransferCaseResponse;t&&q("Case is transferred to "+t.data.data.full_name,"success")}else{await c.transferBulkCase({from_user_id:f.value,to_user_id:_.value.user_id});const t=c.getTransferCaseResponse;t&&q("Case is transferred to "+t.data.data.full_name,"success")}i.value=!1,M.value=!1,r.value.page=r.value.page-1,_.value.user_id="",v()}catch(t){i.value=!1,q(t,"error")}},p=a(!1),W=()=>{},q=(t,T="error",G=5e3)=>{ae.emit("show-toast",{severity:T,summary:"",detail:t,life:G})};return{dt:O,lazyParams:r,totalRecords:x,records:R,isLoading:i,search:P,statusOptions:I,selectedStatus:S,userOptions:V,selectedUser:f,onPage:K,onSort:A,toggleColumnMenu:N,selectedColumns:j,columns:k,columnMenu:y,transferTo:_,cmUserOptions:F,transferCase:s,visibleTransfer:M,downloadCases:W,visibleDownload:p,transferTitle:D,isBulkTransfer:g,transferBulkCaseClick:o}};const z=i=>(ue("data-v-4e0169ef"),i=i(),de(),i),Se={class:"card mb-4"},Te={class:"grid"},xe={class:"field col-12 md:col-6 lg:col-4"},Pe=z(()=>l("label",{class:"label-sm"},[l("i",{class:"pi pi-filter"}),U("  Status ")],-1)),Ve={class:"field col-12 md:col-6 lg:col-4"},Me=z(()=>l("label",{class:"label-sm"},[l("i",{class:"pi pi-filter"}),U("  CM ")],-1)),$e={key:0,class:"field col-12 md:col-6 lg:col-4"},Le=z(()=>l("label",{class:"label-sm"},[l("i",{class:"pi pi-filter"}),U("  Bulk Transfer ")],-1)),Ue={class:"card"},ze={class:"flex flex-wrap flex-row-reverse align-items-center"},Oe={class:"p-input-icon-left mr-2 mb-2 flex-1"},Re=z(()=>l("i",{class:"pi pi-search"},null,-1)),Be=["for"],De={key:0},Ae={key:1},Ne={key:2},Fe={key:1},Ie={class:"text-center w-full"},Ee={class:"mt-2"},Ke={class:"field col-12"},je=z(()=>l("div",{class:"field col-12"},null,-1)),qe={__name:"List",setup(i){const{statusOptions:c,selectedStatus:y,userOptions:O,selectedUser:r,dt:R,lazyParams:x,totalRecords:P,records:w,isLoading:I,search:k,onPage:S,onSort:V,selectedColumns:f,columns:B,columnMenu:D,transferTo:g,transferCase:E,cmUserOptions:v,visibleTransfer:h,downloadCases:K,visibleDownload:A,transferTitle:N,isBulkTransfer:j,transferBulkCaseClick:M}=ke(),{isMobile:F}=pe();return($,o)=>{const _=re("router-link");return u(),m(Y,null,[l("div",null,[l("div",Se,[l("div",Te,[l("div",xe,[Pe,n(e(he),{modelValue:e(y),"onUpdate:modelValue":o[0]||(o[0]=s=>J(y)?y.value=s:null),options:e(c),"aria-labelledby":"basic",class:"w-full"},null,8,["modelValue","options"])]),l("div",Ve,[Me,n(e(Z),{modelValue:e(r),"onUpdate:modelValue":o[1]||(o[1]=s=>J(r)?r.value=s:null),options:e(O),optionLabel:"full_name",optionValue:"id",placeholder:"Select CM",class:"w-full",showClear:""},null,8,["modelValue","options"])]),$.$can("transfer","Case")?(u(),m("div",$e,[Le,n(e(C),{class:"w-full",label:"All Ongoing Cases",icon:"pi pi-arrow-up-right",onClick:e(M),severity:"primary",outlined:""},null,8,["onClick"])])):b("",!0)])]),l("div",Ue,[n(e(ge),{ref_key:"dt",ref:R,dataKey:"id",lazy:!0,paginator:!0,value:e(w),onPage:o[3]||(o[3]=s=>e(S)(s)),onSort:o[4]||(o[4]=s=>e(V)(s)),sortMode:"multiple",multiSortMeta:e(x).multiSortMeta,totalRecords:e(P),rows:5,rowsPerPageOptions:[5,10,20,50,100],scrollable:!0,first:e(x).first,scrollHeight:"60vh",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"{first} to {last} of total {totalRecords}",loading:e(I),responsiveLayout:"scroll"},{header:d(()=>[l("div",ze,[n(e(C),{class:"mb-2 flex-2 mr-2",label:"Download",icon:"pi pi-download",severity:"secondary",text:""}),l("span",Oe,[Re,n(e(be),{modelValue:e(k),"onUpdate:modelValue":o[2]||(o[2]=s=>J(k)?k.value=s:null),placeholder:"Keyword Search",class:"w-full md:w-auto"},null,8,["modelValue"])]),n(e(me),{ref_key:"columnMenu",ref:D,appendTo:"body",id:"columnPanel",style:{width:"250px"}},{default:d(()=>[(u(!0),m(Y,null,X(e(B),s=>(u(),m("div",{key:s.field,class:"field-checkbox"},[n(e(ve),{inputId:s.field,name:"column",modelValue:s.selected,binary:!0,onChange:p=>s.selected=!s.selected,disabled:s.frozen},null,8,["inputId","modelValue","onChange","disabled"]),l("label",{for:s.field},L(s.header),9,Be)]))),128))]),_:1},512)])]),empty:d(()=>[U(" No records found. ")]),loading:d(()=>[U(" Loading records data. Please wait. ")]),default:d(()=>[(u(!0),m(Y,null,X(e(f),s=>(u(),Q(e(_e),{key:s.field,field:s.field,header:s.header,sortable:s.sortable,frozen:!e(F)&&s.frozen,alignFrozen:s.alignFrozen,style:ie(s.style)},{body:d(({data:p})=>[$.$can("view","Case")?(u(),Q(_,{key:0,class:"text-black-alpha-90",to:{name:"viewCase",params:{id:p.id}}},{default:d(()=>[s.field==="am_number"?(u(),m("div",De,L(p.am_number),1)):b("",!0),s.field==="user_full_name"?(u(),m("div",Ae,L(p.user_full_name),1)):b("",!0),s.field==="patient_name"?(u(),m("div",Ne,L(p.patient_name),1)):b("",!0)]),_:2},1032,["to"])):b("",!0),s.field==="actions"?(u(),m("div",Fe,[$.$can("transfer","Case")?(u(),Q(e(C),{key:0,type:"button",icon:"pi pi-arrow-up-right",class:"p-button-primary",text:"",rounded:"",onClick:W=>(h.value=!0,e(g).case_id=p.id,N.value=`Transfer Case [${p.id}] to: `,j.value=!1)},null,8,["onClick"])):b("",!0)])):b("",!0)]),_:2},1032,["field","header","sortable","frozen","alignFrozen","style"]))),128))]),_:1},8,["value","multiSortMeta","totalRecords","first","loading"])])]),n(e(Ce),null,{message:d(s=>[l("div",Ie,[l("i",{class:ne([s.message.icon,"mt-2 text-red-500 text-5xl"])},null,2),l("div",Ee,L(s.message.message),1)])]),_:1}),n(e(ee),{closable:!1,visible:e(h),modal:"",style:{width:"25rem"},header:e(N)},{footer:d(()=>[n(e(C),{label:"Cancel",icon:"pi pi-times",onClick:o[6]||(o[6]=s=>h.value=!1),text:""}),n(e(C),{label:"Transfer",icon:"pi pi-check",onClick:e(E),autofocus:""},null,8,["onClick"])]),default:d(()=>[l("div",Ke,[n(e(Z),{id:"transfer_to",modelValue:e(g).user_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e(g).user_id=s),options:e(v),optionLabel:"full_name",optionValue:"id",class:"w-full",filter:""},null,8,["modelValue","options"])])]),_:1},8,["visible","header"]),n(e(ee),{closable:!1,visible:e(A),modal:"",style:{width:"25rem"},header:"Download Cases Report"},{footer:d(()=>[n(e(C),{label:"Cancel",icon:"pi pi-times",onClick:o[7]||(o[7]=s=>A.value=!1),text:""}),n(e(C),{label:"Transfer",icon:"pi pi-check",onClick:e(K),autofocus:""},null,8,["onClick"])]),default:d(()=>[je]),_:1},8,["visible"])],64)}}},ls=oe(qe,[["__scopeId","data-v-4e0169ef"]]);export{ls as default};
