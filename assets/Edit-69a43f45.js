import{W as X,E as Y,z as g,S as Z,A as ee,L as se,B as ae,_ as le,r as oe,o as n,c as i,a as l,G as e,b as f,n as m,e as S,t as u,i as p,F as R,p as A,g as P,w as te,V as re,k as T,P as ne,Q as ie}from"./index-69d6ec4d.js";import{s as M}from"./dropdown.esm-4fdf3fce.js";import{s as de,a as ue}from"./radiobutton.esm-706421dd.js";import{s as me}from"./fileupload.esm-31ce458e.js";import{s as N}from"./inputtext.esm-b63f6d65.js";import{s as ce}from"./password.esm-d11f9df3.js";import{L as pe}from"./Loading-3900a3c3.js";import{r as O,c as W,m as D,e as _e,n as ve,a as fe,u as he}from"./index-c9e07145.js";import{u as $e}from"./store-c6325eec.js";import{u as we}from"./globalStore-bbb814f5.js";import{E as ge}from"./serverValidation-35937a0f.js";import{p as z}from"./placeholder-716a2605.js";import"./index.esm-922b7932.js";const be=()=>{const h=$e(),b=we(),s=X(),E=Y(),c=g(!0),V=new ge,o=Z({username:"",full_name:"",password:null,email:"",mobile_number:"",avatar:null,role_id:null,status:"Active",avatar_updated:!1,parent_user_id:null,township:"Hlaingtharya",ward_villages:null}),y=g(z),C=g([]),r=g([]),w=g([]),U=g(!0),F=g([]),I=g([{name:"Active",code:"Active"},{name:"Inactive",code:"Inactive"},{name:"Locked",code:"Locked"}]),q={username:{required:O},full_name:{required:O},password:{minLength:W.withMessage("Value should be at least 8 characters",D(8))},email:{email:_e},mobile_number:{numeric:ve,minLength:W.withMessage("Value should be at least 6 characters",D(6)),maxLength:fe(12)},role_id:{required:O},status:{required:O},parent_user_id:{},township:{},ward_villages:{}},_=g(!1),d=he(q,o);ee(()=>{a(),x(),L(),G(),B()}),se(()=>{h.$dispose()});const x=async()=>{c.value=!0,V.clear(),await h.fetchOne({id:s.params.id});const t=h.getOneResponse;t&&(o.username=t.data.username,o.full_name=t.data.full_name,o.email=t.data.email,o.mobile_number=t.data.mobile_number,o.avatar=t.data.avatar,o.role_id=t.data.role_id,o.status=t.data.failed_login_count>=5?"Locked":t.data.status,o.parent_user_id=t.data.parent_user_id,o.township=t.data.township,o.ward_villages=JSON.parse(t.data.ward_villages),o.avatar!=null&&(y.value=o.avatar)),c.value=!1},a=async()=>{c.value=!0,await h.fetchAllRole();const t=h.getAllRoleResponse;if(t){const{options:v}=t.data;for(let $=0;$<v.length;$+=1)C.value.push({name:v[$].name,code:v[$].id})}},L=async()=>{c.value=!0,await b.fetchAllUser();const t=b.getAllUserResponse;if(t){const{options:v}=t.data;for(let $=0;$<v.length;$+=1)r.value.push({name:v[$].full_name,code:v[$].id})}c.value=!1},G=async()=>{c.value=!0,await b.fetchAllTownship();const t=b.getAllTownshipResponse;t&&(w.value=t),c.value=!1};ae(()=>o.township,()=>{B()});const B=async()=>{U.value=!0,await b.fetchAllWards({township:o.township});const t=b.getAllWardResponse;t&&(F.value=t,U.value=!1)},J=t=>{const v=t.files[0];if(v){o.avatar_updated=!0,o.avatar=v;const $=new FileReader;$.onload=K=>{y.value=K.target.result},$.readAsDataURL(v)}},j=()=>{o.avatar=null,y.value=z},H=t=>{_.value=!0,t&&(c.value||Q())},Q=async()=>{V.clear(),c.value=!0;try{await h.update({id:s.params.id,full_name:o.full_name,password:o.password,email:o.email,mobile_number:o.mobile_number,avatar:o.avatar instanceof File?o.avatar:null,role_id:o.role_id,status:o.status,avatar_updated:o.avatar_updated,parent_user_id:o.parent_user_id,township:o.township,ward_villages:JSON.stringify(o.ward_villages)}),h.getUpdateResponse&&E.push({name:"userList"}),c.value=!1}catch(t){if(console.log(t),c.value=!1,t.status===422){const v=t.data.data;V.record(v)}}};return{isLoading:c,state:o,statuses:I,roles:C,onFileChange:J,onFileRemove:j,avatarPreview:y,v$:d,handleSubmit:H,submitted:_,errors:V,townshipOptions:w,userOptions:r,fetchWards:B,wardOptions:F,wardDisabled:U}};const k=h=>(ne("data-v-195faa2d"),h=h(),ie(),h),Ve={class:"card"},ye=k(()=>l("h5",{class:"text-start"},null,-1)),ke={class:"grid"},Ue={class:"field col-12 flex align-items-center"},Le={class:"flex align-items-center"},Se=["src"],Re={class:"field col-12 md:col-6 lg:col-6"},Ae=k(()=>l("span",{class:"p-error"},"*",-1)),Ce={key:0,class:"p-error"},Fe={key:1,class:"p-error"},Ne={class:"field col-12 md:col-6 lg:col-6"},Oe=k(()=>l("span",{class:"p-error"},"*",-1)),Ee={key:0,class:"p-error"},Ie={key:1,class:"p-error"},qe={class:"field col-12 md:col-6 lg:col-6"},xe=k(()=>l("span",{class:"p-error"},"*",-1)),Be={key:0,class:"p-error"},Me={key:0},Pe={key:1},Te={class:"field col-12 md:col-6 lg:col-6"},We={key:0},De={class:"p-error"},ze={class:"field col-12 md:col-6 lg:col-6"},Ge={key:0,class:"p-error"},Je={key:1,class:"p-error"},je={class:"field col-12 md:col-6 lg:col-6"},He=k(()=>l("span",{class:"p-error"},"*",-1)),Qe={key:0,class:"p-error"},Ke={class:"field col-12 md:col-6 lg:col-6"},Xe={class:"field col-12 md:col-6 lg:col-6"},Ye={class:"field col-12 md:col-6 lg:col-6"},Ze={class:"field col-12 md:col-6 lg:col-6"},es=k(()=>l("span",{class:"p-error"},"*",-1)),ss={class:"flex flex-wrap gap-3 mt-2"},as=["for"],ls={key:0,class:"p-error"},os={class:"flex justify-content-end"},ts={class:"m-2"},rs={class:"m-2"},ns={__name:"Edit",setup(h){const{isLoading:b,v$:s,statuses:E,roles:c,onFileChange:V,onFileRemove:o,avatarPreview:y,handleSubmit:C,submitted:r,errors:w,userOptions:U,townshipOptions:F,wardOptions:I,wardDisabled:q}=be();return(_,d)=>{const x=oe("router-link");return n(),i("div",Ve,[ye,l("form",{class:"p-fluid",onSubmit:d[9]||(d[9]=re(a=>e(C)(!e(s).$invalid),["prevent"]))},[l("div",ke,[l("div",Ue,[l("div",Le,[l("img",{src:e(y),class:"mr-4 avatar"},null,8,Se),f(e(me),{mode:"basic",customUpload:"true",name:"avatar",accept:"image/*",class:"p-button-outlined p-button-plain",chooseLabel:"Browse",onClear:e(o),onSelect:e(V)},null,8,["onClear","onSelect"])])]),l("div",Re,[l("label",{for:"username",class:m({"p-error":e(s).username.$invalid&&e(r)})},[S("Username"),Ae],2),f(e(N),{id:"username",modelValue:e(s).username.$model,"onUpdate:modelValue":d[0]||(d[0]=a=>e(s).username.$model=a),class:m({"p-invalid":e(s).username.$invalid&&e(r)}),readonly:"true"},null,8,["modelValue","class"]),e(s).username.$invalid&&e(r)||e(s).username.$pending.$response?(n(),i("small",Ce,u(e(s).username.required.$message.replace("Value","Username")),1)):p("",!0),e(w).has("username")?(n(),i("small",Fe,[(n(!0),i(R,null,A(e(w).get("username"),a=>(n(),i("div",{key:a},u(a),1))),128))])):p("",!0)]),l("div",Ne,[l("label",{for:"full_name",class:m({"p-error":e(s).full_name.$invalid&&e(r)})},[S(u(_.$t("Full Name")),1),Oe],2),f(e(N),{id:"full_name",modelValue:e(s).full_name.$model,"onUpdate:modelValue":d[1]||(d[1]=a=>e(s).full_name.$model=a),class:m({"p-invalid":e(s).full_name.$invalid&&e(r)})},null,8,["modelValue","class"]),e(s).full_name.$invalid&&e(r)||e(s).full_name.$pending.$response?(n(),i("small",Ee,u(e(s).full_name.required.$message.replace("Value","Full Name")),1)):p("",!0),e(w).has("full_name")?(n(),i("small",Ie,[(n(!0),i(R,null,A(e(w).get("full_name"),a=>(n(),i("div",{key:a},u(a),1))),128))])):p("",!0)]),l("div",qe,[l("label",{for:"password",class:m({"p-error":e(s).password.$invalid&&e(r)})},[S(u(_.$t("Password")),1),xe],2),f(e(ce),{id:"password",modelValue:e(s).password.$model,"onUpdate:modelValue":d[2]||(d[2]=a=>e(s).password.$model=a),autocomplete:"new-password",placeholder:"Password",class:m({"p-invalid":e(s).password.$invalid&&e(r)}),feedback:!1,toggleMask:""},null,8,["modelValue","class"]),e(s).password.$invalid&&e(r)||e(s).password.$pending.$response?(n(),i("small",Be,[e(s).password.required.$invalid?(n(),i("span",Me,u(e(s).password.required.$message.replace("Value","User password")),1)):p("",!0),e(s).password.minLength.$invalid?(n(),i("span",Pe,u(e(s).password.minLength.$message.replace("Value","User password")),1)):p("",!0)])):p("",!0)]),l("div",Te,[l("label",{for:"email",class:m({"p-error":e(s).email.$invalid&&e(r)})},u(_.$t("Email")),3),f(e(N),{id:"email",modelValue:e(s).email.$model,"onUpdate:modelValue":d[3]||(d[3]=a=>e(s).email.$model=a),class:m({"p-invalid":e(s).email.$invalid&&e(r)}),"aria-describedby":"email-error"},null,8,["modelValue","class"]),e(s).email.$error&&e(r)?(n(),i("span",We,[(n(!0),i(R,null,A(e(s).email.$errors,(a,L)=>(n(),i("span",{id:"email-error",key:L},[l("small",De,u(a.$message),1)]))),128))])):p("",!0)]),l("div",ze,[l("label",{for:"mobile_number",class:m({"p-error":e(s).mobile_number.$invalid&&e(r)})},u(_.$t("Mobile Number")),3),f(e(N),{id:"mobile_number",modelValue:e(s).mobile_number.$model,"onUpdate:modelValue":d[4]||(d[4]=a=>e(s).mobile_number.$model=a),class:m({"p-invalid":e(s).mobile_number.$invalid&&e(r)})},null,8,["modelValue","class"]),e(s).mobile_number.$invalid&&e(r)||e(s).mobile_number.$pending.$response?(n(),i("small",Ge,u(e(s).mobile_number.required.$message.replace("Value","PhoneNumber")),1)):p("",!0),e(w).has("phone_number")?(n(),i("small",Je,[(n(!0),i(R,null,A(e(w).get("phone_number"),a=>(n(),i("div",{key:a},u(a),1))),128))])):p("",!0)]),l("div",je,[l("label",{for:"role",class:m({"p-error":e(s).role_id.$invalid&&e(r)})},[S(u(_.$t("Role")),1),He],2),f(e(M),{modelValue:e(s).role_id.$model,"onUpdate:modelValue":d[5]||(d[5]=a=>e(s).role_id.$model=a),options:e(c),optionLabel:"name",optionValue:"code",placeholder:"Select role",class:"w-full",showClear:""},null,8,["modelValue","options"]),e(s).role_id.$invalid&&e(r)||e(s).role_id.$pending.$response?(n(),i("small",Qe,u(e(s).role_id.required.$message.replace("Value","User role")),1)):p("",!0)]),l("div",Ke,[l("label",{for:"supervisor",class:m({"p-error":e(s).parent_user_id.$invalid&&e(r)})},u(_.$t("Supervisor")),3),f(e(M),{id:"supervisor",modelValue:e(s).parent_user_id.$model,"onUpdate:modelValue":d[6]||(d[6]=a=>e(s).parent_user_id.$model=a),options:e(U),optionLabel:"name",optionValue:"code",placeholder:"Select supervisor",class:"w-full",showClear:"",filter:""},null,8,["modelValue","options"])]),l("div",Xe,[l("label",{for:"township",class:m({"p-error":e(s).township.$invalid&&e(r)})},u(_.$t("Township")),3),f(e(M),{id:"township",modelValue:e(s).township.$model,"onUpdate:modelValue":d[7]||(d[7]=a=>e(s).township.$model=a),options:e(F),optionLabel:"name",optionValue:"name",class:"w-full",showClear:"",filter:""},null,8,["modelValue","options"])]),l("div",Ye,[l("label",{for:"ward_villages",class:m({"p-error":e(s).ward_villages.$invalid&&e(r)})},u(_.$t("Wards/Village")),3),f(e(de),{display:"chip",disabled:e(q),id:"ward_villages",modelValue:e(s).ward_villages.$model,"onUpdate:modelValue":d[8]||(d[8]=a=>e(s).ward_villages.$model=a),options:e(I),optionLabel:"name_en",optionValue:"name_en",class:"w-full",showClear:"",filter:""},null,8,["disabled","modelValue","options"])]),l("div",Ze,[l("label",{for:"status",class:m({"p-error":e(s).status.$invalid&&e(r)})},[S(u(_.$t("Status")),1),es],2),l("div",ss,[(n(!0),i(R,null,A(e(E),a=>(n(),i("div",{key:a.code,class:"flex align-items-center"},[f(e(ue),{modelValue:e(s).status.$model,"onUpdate:modelValue":L=>e(s).status.$model=L,inputId:a.code,name:"status",value:a.name},null,8,["modelValue","onUpdate:modelValue","inputId","value"]),l("label",{for:a.code,class:"ml-2"},u(a.name),9,as)]))),128))]),e(s).status.$invalid&&e(r)||e(s).status.$pending.$response?(n(),i("small",ls,u(e(s).status.required.$message.replace("Value","User status")),1)):p("",!0)])]),l("div",os,[_.$can("index","User")?(n(),P(x,{key:0,to:{name:"userList"}},{default:te(()=>[l("div",ts,[f(e(T),{label:"Cancel",severity:"secondary",text:"",class:"shadow-1"})])]),_:1})):p("",!0),l("div",rs,[f(e(T),{type:"submit",label:"Save",severity:"primary"})])])],32),e(b)?(n(),P(pe,{key:0})):p("",!0)])}}},bs=le(ns,[["__scopeId","data-v-195faa2d"]]);export{bs as default};
