import{z as a,A as te,L as le,M as ae,B as j,N as oe,_ as re,r as ne,o as i,c as p,a as l,b as d,G as e,I as q,i as m,w as c,F as J,p as X,e as D,n as ie,t as T,k as w,g as G,H as de,P as ue,Q as ce}from"./index-c2c75714.js";import{m as fe,u as pe,a as me,s as ve,b as _e,c as ge,d as he}from"./device-c1be46b9.js";import{s as ye}from"./selectbutton.esm-d2e138d1.js";import{s as Ce}from"./inputtext.esm-57738831.js";import{s as Z}from"./dropdown.esm-796bdaf9.js";import{s as be}from"./confirmdialog.esm-a3dccb93.js";import{a as ee}from"./dialog.esm-40411f54.js";import{u as we}from"./store-230c42c6.js";import{u as ke}from"./globalStore-bbc9899f.js";import"./paginator.esm-b080827f.js";import"./index.esm-78a308cd.js";const Se=()=>{const n=a(!0),f=we(),k=a(),S=a(),u=a({}),$=a(),R=a(0),P=a(""),U=ke(),V=a(["Ongoing","Completed","Discharged"]),I=a([{field:"id",header:"ID",selected:!1,style:"min-width: 5rem",frozen:!1},{field:"am_number",header:"AM Number",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"length_of_stay",header:"Length of Stay",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"user_full_name",header:"CM",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"patient_name",header:"Patient",sortable:!0,selected:!0,style:"min-width: 5rem"},{field:"actions",header:"Transfers",sortable:!1,selected:!0,style:"min-width: 10rem",frozen:!0,alignFrozen:"right"}]),M=a("Ongoing"),v=a(null),A=a(null),N=a("Transfer case to:"),y=a(!1);te(()=>{C(),_(),K()}),le(()=>{f.$dispose()});const _=async()=>{n.value=!0,await f.fetchAll({page:u.value.page+=1,per_page:u.value.rows,order:fe(u.value.multiSortMeta),search:P.value,status:M.value,user_id:v.value});const t=f.getAllResponse;t&&($.value=t.data,R.value=t.meta.total),n.value=!1},C=()=>{u.value={page:0,rows:S.value.rows,multiSortMeta:[],first:0}},x=t=>{u.value=t,u.value.multiSortMeta=[],_()},H=t=>{u.value=t,u.value.page=0,u.value.first=0,_()},F=t=>{k.value.toggle(t)},E=ae(()=>I.value.filter(t=>t.selected)),O=a(!1),z=a([]);j([P],pe(()=>{C(),_()},500)),j([v],()=>{A.value=z.value.find(t=>t.id==v.value).full_name}),j([v,M],()=>{C(),_()});const K=async()=>{console.log("fetching users"),n.value=!0,await U.fetchAllUser({role:4});const t=U.getAllUserResponse;if(t){const{options:h}=t.data;z.value=h}n.value=!1},Q=()=>{if(v.value==null){alert("You need to choose CM");return}if(M.value!="Ongoing"){alert("Only Ongoing cases can be transferred");return}O.value=!0,N.value=`Transfer Ongoing Cases of [${A.value}] to:`,y.value=!0},g=a({user_id:"",case_id:""}),b=async()=>{if(g.value.user_id==""){alert("Select CM");return}n.value=!0;try{if(y.value===!1){await f.transferCase({case_id:g.value.case_id,user_id:g.value.user_id});const t=f.getTransferCaseResponse;t&&r("Case is transferred to "+t.data.data.full_name,"success")}else{await f.transferBulkCase({from_user_id:v.value,to_user_id:g.value.user_id});const t=f.getTransferCaseResponse;t&&r("Case is transferred to "+t.data.data.full_name,"success")}n.value=!1,O.value=!1,u.value.page=u.value.page-1,g.value.user_id="",_()}catch(t){n.value=!1,r(t,"error")}},o=a(!1),Y=a(!1),s=()=>{},r=(t,h="error",L=5e3)=>{oe.emit("show-toast",{severity:h,summary:"",detail:t,life:L})};return{dt:S,lazyParams:u,totalRecords:R,records:$,isLoading:n,search:P,statusOptions:V,selectedStatus:M,selectedUser:v,onPage:x,onSort:H,toggleColumnMenu:F,selectedColumns:E,columns:I,columnMenu:k,transferTo:g,cmUserOptions:z,transferCase:b,visibleTransfer:O,downloadCases:s,visibleDownload:o,visibleDelete:Y,transferTitle:N,isBulkTransfer:y,transferBulkCaseClick:Q,calculateLengthOfStay:(t,h)=>{let L=null;const se=new Date(t);return L=(new Date(h)-se)/(1e3*60*60*24),L=Math.round(L),L},deleteCase:async t=>{if(confirm("Are you sure you want to delete this case?")){console.log(t),n.value=!0;try{await f.deleteCase({id:t}),f.getDeleteCaseResponse&&(r("Case deleted successfully","success"),C(),_())}catch(h){r(h,"error")}finally{n.value=!1}}}}};const B=n=>(ue("data-v-27201039"),n=n(),ce(),n),Me={class:"card mb-4"},Le={class:"grid"},Te={class:"field col-12 md:col-6 lg:col-4"},$e=B(()=>l("label",{class:"label-sm"},[l("i",{class:"pi pi-filter"}),D("  Status ")],-1)),Pe={key:0,class:"field col-12 md:col-6 lg:col-4"},Ve=B(()=>l("label",{class:"label-sm"},[l("i",{class:"pi pi-filter"}),D("  CM ")],-1)),xe={key:1,class:"field col-12 md:col-6 lg:col-4"},Oe=B(()=>l("label",{class:"label-sm"},[l("i",{class:"pi pi-filter"}),D("  Bulk Transfer ")],-1)),ze={class:"card"},De={class:"flex flex-wrap flex-row-reverse align-items-center"},Be={class:"p-input-icon-left mr-2 mb-2 flex-1"},Re=B(()=>l("i",{class:"pi pi-search"},null,-1)),Ue=["for"],Ie={key:0},Ae={key:1},Ne={key:2},Fe={key:3},Ee={key:1},Ge={class:"text-center w-full"},He={class:"mt-2"},Ke={class:"field col-12"},Qe=B(()=>l("div",{class:"field col-12"},null,-1)),Ye={__name:"List",setup(n){const{statusOptions:f,selectedStatus:k,selectedUser:S,dt:u,lazyParams:$,totalRecords:R,records:P,isLoading:U,search:V,onPage:I,onSort:M,selectedColumns:v,columns:A,columnMenu:N,transferTo:y,transferCase:_,cmUserOptions:C,visibleTransfer:x,downloadCases:H,visibleDownload:F,transferTitle:E,isBulkTransfer:O,transferBulkCaseClick:z,calculateLengthOfStay:K,deleteCase:Q}=Se(),{isMobile:g}=me();return(b,o)=>{const Y=ne("router-link");return i(),p(J,null,[l("div",null,[l("div",Me,[l("div",Le,[l("div",Te,[$e,d(e(ye),{modelValue:e(k),"onUpdate:modelValue":o[0]||(o[0]=s=>q(k)?k.value=s:null),options:e(f),"aria-labelledby":"basic",class:"w-full"},null,8,["modelValue","options"])]),b.$can("transfer","BulkCase")?(i(),p("div",Pe,[Ve,d(e(Z),{modelValue:e(S),"onUpdate:modelValue":o[1]||(o[1]=s=>q(S)?S.value=s:null),options:e(C),optionLabel:"full_name",optionValue:"id",placeholder:"Select CM",class:"w-full",showClear:""},null,8,["modelValue","options"])])):m("",!0),b.$can("transfer","BulkCase")?(i(),p("div",xe,[Oe,d(e(w),{class:"w-full",label:"All Ongoing Cases",icon:"pi pi-arrow-up-right",onClick:e(z),severity:"primary",outlined:""},null,8,["onClick"])])):m("",!0)])]),l("div",ze,[d(e(he),{ref_key:"dt",ref:u,dataKey:"id",lazy:!0,paginator:!0,value:e(P),onPage:o[3]||(o[3]=s=>e(I)(s)),onSort:o[4]||(o[4]=s=>e(M)(s)),sortMode:"multiple",multiSortMeta:e($).multiSortMeta,totalRecords:e(R),rows:5,rowsPerPageOptions:[5,10,20,50,100],scrollable:!0,first:e($).first,scrollHeight:"60vh",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"{first} to {last} of total {totalRecords}",loading:e(U),responsiveLayout:"scroll"},{header:c(()=>[l("div",De,[l("span",Be,[Re,d(e(Ce),{modelValue:e(V),"onUpdate:modelValue":o[2]||(o[2]=s=>q(V)?V.value=s:null),placeholder:"Keyword Search",class:"w-full md:w-auto"},null,8,["modelValue"])]),d(e(ve),{ref_key:"columnMenu",ref:N,appendTo:"body",id:"columnPanel",style:{width:"250px"}},{default:c(()=>[(i(!0),p(J,null,X(e(A),s=>(i(),p("div",{key:s.field,class:"field-checkbox"},[d(e(_e),{inputId:s.field,name:"column",modelValue:s.selected,binary:!0,onChange:r=>s.selected=!s.selected,disabled:s.frozen},null,8,["inputId","modelValue","onChange","disabled"]),l("label",{for:s.field},T(s.header),9,Ue)]))),128))]),_:1},512)])]),empty:c(()=>[D(" No records found. ")]),loading:c(()=>[D(" Loading records data. Please wait. ")]),default:c(()=>[(i(!0),p(J,null,X(e(v),s=>(i(),G(e(ge),{key:s.field,field:s.field,header:s.header,sortable:s.sortable,frozen:!e(g)&&s.frozen,alignFrozen:s.alignFrozen,style:de(s.style)},{body:c(({data:r})=>[b.$can("view","Case")?(i(),G(Y,{key:0,class:"text-black-alpha-90",to:{name:"viewCase",params:{id:r.id}}},{default:c(()=>[s.field==="am_number"?(i(),p("div",Ie,T(r.am_number),1)):m("",!0),s.field==="length_of_stay"?(i(),p("div",Ae,T(e(K)(r.date_of_admission!==void 0?r.date_of_admission:"",new Date().toISOString().split("T")[0]))+" Days ",1)):m("",!0),s.field==="user_full_name"?(i(),p("div",Ne,T(r.user_full_name),1)):m("",!0),s.field==="patient_name"?(i(),p("div",Fe,T(r.patient_name),1)):m("",!0)]),_:2},1032,["to"])):m("",!0),s.field==="actions"?(i(),p("div",Ee,[b.$can("transfer","Case")?(i(),G(e(w),{key:0,type:"button",icon:"pi pi-arrow-up-right",class:"p-button-primary",text:"",rounded:"",onClick:W=>(x.value=!0,e(y).case_id=r.id,E.value=`Transfer Case [${r.id}] to: `,O.value=!1)},null,8,["onClick"])):m("",!0),b.$can("delete","Case")?(i(),G(e(w),{key:1,type:"button",icon:"pi pi-trash",class:"p-button-danger",text:"",rounded:"",onClick:W=>e(Q)(r.id)},null,8,["onClick"])):m("",!0)])):m("",!0)]),_:2},1032,["field","header","sortable","frozen","alignFrozen","style"]))),128))]),_:1},8,["value","multiSortMeta","totalRecords","first","loading"])])]),d(e(be),null,{message:c(s=>[l("div",Ge,[l("i",{class:ie([s.message.icon,"mt-2 text-red-500 text-5xl"])},null,2),l("div",He,T(s.message.message),1)])]),_:1}),d(e(ee),{closable:!1,visible:e(x),modal:"",style:{width:"25rem"},header:e(E)},{footer:c(()=>[d(e(w),{label:"Cancel",icon:"pi pi-times",onClick:o[6]||(o[6]=s=>x.value=!1),text:""}),d(e(w),{label:"Transfer",icon:"pi pi-check",onClick:e(_),autofocus:""},null,8,["onClick"])]),default:c(()=>[l("div",Ke,[d(e(Z),{id:"transfer_to",modelValue:e(y).user_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e(y).user_id=s),options:e(C),optionLabel:"full_name",optionValue:"id",class:"w-full",filter:""},null,8,["modelValue","options"])])]),_:1},8,["visible","header"]),d(e(ee),{closable:!1,visible:e(F),modal:"",style:{width:"25rem"},header:"Download Cases Report"},{footer:c(()=>[d(e(w),{label:"Cancel",icon:"pi pi-times",onClick:o[7]||(o[7]=s=>F.value=!1),text:""}),d(e(w),{label:"Download",icon:"pi pi-check",onClick:e(H),autofocus:""},null,8,["onClick"])]),default:c(()=>[Qe]),_:1},8,["visible"])],64)}}},is=re(Ye,[["__scopeId","data-v-27201039"]]);export{is as default};
